---
layout: post
title: 第十二章操作系统笔记
tags: [Learning]
---
# 第十二章 文件系统
- I/O设备
- I/O功能的组织
- 操作系统的I/O设计
- I/O缓冲
- 磁盘调度
- 磁盘高速缓存
- 主流操作系统的I/O

## 文件系统的引入
- 所有计算机应用程序都需要：存储信息、检索信
- 三个基本要求
	- 存储大量信息
	- 长期保存信息
	- 可以共享信息
- 解决方案
	- 把信息以一种单元，即文件的形式存储在外部介质上
	- 文件是通过操作系统来管理的，包括文件的结构、命名、存取、使用、保护和实现方法等
	- 对文件的操作
		- 创建/删除
		- 打开/关闭
		- 读/写

## 文件相关术语
- 字段/域（field）：如姓名、年龄
- 记录（record）：一组相关的域
- 文件（file）：相关记录的集合
- 数据库：相关数据的集合

## 文件
- 文件：带标识（称为文件名）的在逻辑上有完整意义的一组信息项序列
	- 信息项：构成文件内容的基本单位
	- 信息项长度：单个或者多个字节
	- 文件内容的意义：由文件的创建者和使用者解释

## 文件系统
- 文件系统：操作系统中管理文件的模块，提供文件存储和访问功能
- 文件管理的目的
	- 方便的文件访问和控制：以符号名作为文件标识，便于用户使用
	- 并发文件访问何控制：在多道程序系统中支持对文件的并发访问何控制
	- 统一的用户接口：不同设备（硬盘、U盘）相同接口，方便用户操作
	- 多种访问权限
	- 优化性能
	- 差错恢复

### 文件系统软件结构 PPT6

### 文件管理要素 PPT7

### 文件管理功能
1. 文件命名
2. 访问控制：并发访问何用户权限
3. 文件结构管理：划分记录、顺序、索引
4. 目录管理：不包括文件内容，可用于文件访问何控制的信息
5. 文件操作：创建、打开、读写、关闭
6. 文件存取：文件的修改、追加、搜索等
7. 限额（quota）：限制每个用户能够建立的文件数目、占用外存空间大小等
8. 审计（auditing）：记录对指定文件的使用信息

#### 功能元素
- 文件的分块存储：与外村的存储块相配合
- I/O缓冲和调度：性能优化
- 文件分配：在外存上分配文件的各个存储块
- 外存存储空间管理：空闲存储快的管理，分配和释放
- 外存设备的访问何控制

### 文件的命名
命名规则
- 长度
- 合法字符（"、大小写）
- 扩展名的支持（一个或者多个）
	- .o .ps .tex ...

### 文件的分类
- 按文件性质和用途分
	- 系统文件：有关OS及有关系统所组成的文件
	- 库文件：标准子程序及常用应用程序组成的文件，允许用户使用但不能修改
	- 用户文件
- 按信息保存期分
	- 临时文件、永久文件、档案文件
- 按文件保护方式分
	- 只读文件、读写文件、可执行文件
- 按文件的逻辑结构分
	- 流式（无结构）文件、记录式（结构化）文件
	- 按文件的物理结构分：顺序文件，链接文件，索引文件

### 5种基本文件组织的性能等级 PPT 13
堆、顺序、索引顺序、索引、散列

#### 存取方式
- 顺序存取
- 随机存取

#### 字节序列
- 构成文件的基本单位是字节，文件是一个无结构的字节序列，逻辑意义由用户程序解释
- 原理简单，灵活性高
- 不利于检索
- Unix，MS-DOS中采用

#### 堆
- 数据按他们的到达顺序收集
- 目的是积累并存储大量数据
	- 记录可能有不同的域
	- 没有结构，通过特定的分隔符划分记录
	- 通过穷举搜索访问记录

#### 顺序文件
- 记录格式固定
	- 字段的大小和顺序固定
	- 关键字段（key field）唯一标识一个记录
	- 记录按关键字顺序存储
- 特点
	- 通常在批处理应用（如账目）
	- 容易在磁盘和磁带存储
	- 组织成链表
- 随机访问性能差

#### 索引顺序文件
- 在顺序文件基础上，增加了索引提高随机查找速度
	- 可以有多级索引
	- 索引文件中的每个记录由两个字段组成——关键字段和指向主文件的指针
- 溢出区用来处理新纪录
	- 主文件在每个记录中增加一个附加字段，保存指向溢出区中新纪录的指针，初始化为空
	- 新纪录添加到溢出区
	- 修改主文件中在逻辑顺序位于该新纪录前的记录中的附加字段，使其指向溢出区中的新加记录
	- 溢出区以批处理方式合并到主文件

#### 索引文件
- 可以有多个索引，为每个可能搜索的字段设置一个索引
- 只通过索引来访问记录
	- 索引可以是完全索引或者部分索引
- 记录大小不必相同，不必排序
	- 索引指针可以指向文件中的任何位置
- 用于强调速度但很少会处理文件的所有数据的场合

#### 散列文件（Hashed File）
- 利用关键字的散列查找记录
- 没有顺序存取的概念
- 常用于快速访问记录的情形

#### B树
- 平衡树状结构，为数据库中组织索引的标准方法

### 文件目录 PPT23

#### 目录
- FCB（文件控制块）（目录项）组织在一起，FCB的有序集合
	- 操作系统为管理文件而设置的数据结构，存放了管理文件所需的所有有关信息。
- 为了提高检索速度，把FCB中的文件说明分成两部分
	- 符号目录项（次）：文件名、文件内部标识号
	- 基本目录项BFCB（主）：其余文件说明信息

#### 目录内容

#### 目录操作

#### 目录结构

##### 一级目录
- 线性结构，所有文件都在一个目录表中
- 用于简单的单用户操作系统
- 优点：结构简单、容易实现
- 缺点：文件多时目录检索时间长，从而平均检索时间长；有命名冲突

##### 二级目录
- 在根目录下，每个用户对应一个目录（二级目录），在用户目录下是该用户的文件，而不再有下级目录
- 降低了平均检索时间
- 部分客服命名冲突问题
- 不利于用户对文件的分类管理

##### 多级目录 PPT 35
- 每个用户可在其用户目录下自主创建若干层次的子目录（树）
- 也称为树形目录
- 当前主流OS采用
- 优点：层次分明，解决了命名冲突问题
- 缺点：目录级别太多时，增加路径检索时间

##### 改进的多级目录
- 目录项 -\> 符号目录项，基本目录项（BFCB）
- 排序检索
	- 把符号目录项的符号文件目录组织成树状结构，按文件名排序
	- 把基本目录结构构成的基本文件目录组织成线性结构，通过符号目录项映射到这里，实现快速查询 PPT 39
	- 改进前后的查询次数对比：*PPT 40*

### 文件共享
1. 每个用户通过唯一的共享文件路径名访问共享文件
2. 利用多个目录中的不同文件名来描述统一共享文件

### 硬链接
- 基于改进的多级目录结构的功能
- 将目录内容分为两部分
	- 文件名（符号目录项）
	- 索引节点（index node）（属主、访问权限、磁盘地址等）（基本目录项）
- 示意图 PPT 43
#### 存在问题
记账/配额问题：设B、C共享文件file，C是文件主，若C删除了file而B不删除，则file仍然存在，*且仍然是C为file付账，占的也是C的配额*

### 符号链接（软连接）
- 缺点，时间空间开销大，而且可能会形成环状

### 文件的访问控制
- 两大

### 文件的并发访问控制
- 访问文件之前，必须先打开文件

### 记录组块

#### 记录组块的方法

### 辅存管理
- 把空间分配给文件——文件分配
- 跟踪可用空间——空闲空间管理

#### 预分配和动态分配
- 文件创建时是否一次性分配其最大空间？
- 预分配
	- 文件创建时必须要声明文件的最大长度
	- 难以可靠估计文件可能的最大长度
	- 空间浪费
	- 适用于从不改变的文件
- 动态分配
	- 需要时才给文件分配空间

### 区块大小
- 以多大的区块为分配单位？
- 文件分配表（FAT）
	- FAT用来跟踪分配给文件的区块

#### 分配方法
1. 连续分配
2. 连接分配
3. 索引分配

##### 连续分配
- 优点：简单、容易实现
	- 支持顺序存取和随机存取
	- 顺序存取速度快
- 缺点
	- 文件不能动态增长（预留空间则浪费）
	- 存在外部碎片问题（需要重新分配和压缩）

##### 链接分配
- 不存在外部碎片
- 存取速度慢，不适于随机存取

##### 索引分配
- 将一个作为索引块
- 既能顺序存取，也能随机存取
- 满足文件动态增长、插入删除的要求
- 缺点：
	- 较多的寻到次数和寻到时间
	- 索引表本身带来了系统开销：内外存空间、存取时间

### 空闲空间管理
- 位图
- 链式空闲表
- 索引
- 空闲快列表

### 文件系统性能

### 文件系统安全
- 访问矩阵

### Unix的六类文件

