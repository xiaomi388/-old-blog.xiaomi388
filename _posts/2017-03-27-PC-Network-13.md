---
layout: post
title: 计算机网络笔记第十三周
tags: [Learning]
---
## 第十三周

### 复习题
1. RIP问题？
	- 慢收敛问题
	- 计数到无穷
2. RIP协议用到的技术？
	- 水平分割（解决不了回路的问题）
3. 点到点网络一定要配ip地址吗？
	- 不一定的，要指定下一跳时，则按接口指定
	- 以太网不属于点到点网络，是多路访问网络
	- PPP是点到点网络
4. 路由表有哪些项？
	- 网络号
	- 下一跳ip
	- 接口

# 第五单元：网络层OSPF（开放式最短路径优先）协议
- 属于内部网关协议（IGP）：）是在一个自治网络内网关（主机和路由器）间交换路由信息的协议。
	- （EIGRP：增强内部网关协议，思科公司私有协议）
- 使用链路状态路由算法求最短路
- 所有路由器都能收到整个AS的点和边，从而得到拓扑结构图

## 把网络转变为图
- LSA：链路状态通告，描述的是路由器所有的链路或者接口以及这些链路的状态。（这些接口将发送到哪里？权重是多少？）
- 末端网（stub network）：the network that has only a single connection to a router.
- 指定路由器（DR：designated router）：每个中转网都要选举一个直连路由器作为指定路由器。
	- 作用：
		- 负责生成中转网的 LSA（network LSA）
		- 负责将所在的*多路访问网络*收到的LSA转发给所有OSPF路由器
	- （若没有指定路由器，则PPT中蓝色的边没有路由器生成）
- 备份指定路由器（BDR）：当多路访问网络发生变化时，DR负责更新其他所有OSPF路由器。BDR会监控DR 的状态，并在当前DR发生故障时接替其角色。
- 如果图中点到点网络没有配置IP地址，则不用节点N3
- LSA：链路状态广播
- 图中数字含义：从该端口发出的权重（距离）。末端网络不能发送到路由器；中转网络到各个路由器的权重（距离）为0，点到点网络也算是末端网

## 链路状态数据库的建立：
1. 发现邻居：
	- 路由器每10秒向邻居发送Hello分组，表明你还活着
	- 采用多播方式（224.0.0.5，all OSPF routers）
	- 包含优先权、已知邻居、DR、BDR
2. 完全相邻
	- 发现邻居后，和邻居交换LSA。在与邻居链路状态数据库一致时，处于完全相邻状态。
3. 生成LSA
	- 每30分钟或者链路变化生成一次。
	- 中转网的DR会生成 network LSA。
4. 扩散LSA
	- 产生新的LSA后，立刻封装成 UPDATE 分组，被可靠扩散出去。
	- 每次产生的LSA的序号会加1，序列号越大表示越新。
	- 由发出此LSA的路由器ID（发通告路由器），链路状态和序列号唯一确定。
	- 通过序号可以防止扩散形成回路（为什么？）
		- 第二次收到相同的发通告路由器、相同LSA类型和相同序号的LSA，则直接丢弃。
	- 问题：IP分组可通过相同方式防止回路吗？
		- 不行，互联网太大，终端多，IP分组第二次返回则要经过许多终端。
5. 收集LSA
	 - 路由器收到LSA后，用新LSA替换链路状态数据库旧的LSA。
	- 如果一个LSA在60分钟没有被更新，它将从链路状态数据库移除
		- 作用：防止中间链路（路由器）出现故障
		- 但实际上很少用到，因为路由器鼓掌时，Hello分组将得不到故障路由器的返回，从而立即更新LSA。
6. 计算最短路径
7. 建立路由表

## OSPF开销
- 带宽越大，开销越小

## 数据库同步
- 同步过程（PPT）

## 路由器ID
### 选择方式
1. 直接配置的RID
2. 所有活动环回接口中最大的IP地址
3. 所有活动物理接口中最大的IP地址
4. 除非路由器重启、所选接口故障（关闭）、IP地址改变、执行router-id命令，否则RID保持不变

## 指定路由器
- 指定路由器选举过程
	1. 知道网内有哪些邻居
	2. 选择优先权最高的称为DR、次高BDR
	3. 如果优先权一样，则比较RID
- 收到LSA后，一个多路访问网络中的OSPF路由器首先多播给DR和BDR，然后DR再把它们多播给所有OSPF路由器

## LSA定时器
- 10秒发送Hello分组
- 30分钟产生新LSA，最小间隔时间为5秒
- 链路状态数据库中的LSA每10分钟被计算校验和，有错被删除
- 接受来自邻居的LSA的最小间隔时间为1秒
- 计算最短路径的最小间隔时间为10秒
- ......

## OSPF分组格式

### 分组类型
- Hello
- Database Description
- Link State Request
- Link State Update
- Link State Acknowledge

### 分区
OSPF可以分区，至少要有一个区，即主干区（0.0.0.0）

### LS Update分组

#### Router LSA（考试要考，作业有类似的题目）
- TOS：度量值
- 链路ID、链路数据、链路类型、TOS个数、度量值

## OSPF的特点
- OSPF消息需要认证
- 允许多个相同开销的路径存在（RIP只允许一条），实现负载均衡
- 对于每条链路，允许同时多个（TOS）开销
- 多播OSPF使用与OSPF相同的链路状态数据库（思科不行）
- 在大型路由选择域中OSPF可以分区
- 比RIP收敛快而且更安静（为什么？）
	- 每30分钟才扩散一次，所以更安静
	- 一旦链路状态有变化就立即扩散，所以收敛快
- 实现起来更复杂，需要更多的计算开销

## LS（链路状态）算法和DV（距离向量）算法比较
1. 消息复杂性的比较
2. 收敛速度的比较