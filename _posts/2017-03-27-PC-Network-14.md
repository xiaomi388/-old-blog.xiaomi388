---
layout: post
title: 计算机网络笔记第十四周
tags: [Learning]
---
# 第十四周
- EIGRP协议：也是内部网关协议（思科专用）
- IGP：RIP、OSPF、EIGRP
- EGP：BGP
### 复习题
1. OSPF的工作原理
	- 先把网络转换成图，再使用迪杰特斯拉算法求到所有网络的最短路径，找到左右网络最短路径的下一跳
2. RIP协议不需要整个网络的拓扑结构图

## 第五单元 BGP协议
### 早期EGP分类中的EGP协议
问题：要求各个AS间连接不能有回路，要树形连接

### BGP协议
- 采用可靠扩散的方法传递AS内的网络的信息给整个互联网。
- 每个AS需要分配一个号码，与IP地址分配相同，由ICANN机构分配
- 边缘上的路由器才运行BGP协议

### 工作原理
1. BGP路由器被称为BGP发言人（BGP Speeker）
2. BGP路由器间通过179端口建立相邻关系
3. BGP路由器所扩散的网络前缀（网络号）称为*网络层可达信息*（NLRI），连同它们的属性一起通过相邻关系扩散给邻居。
4. 
	- iBGP：AS内BGP路由器建立的相邻关系；
	- eBGP：不同AS间BGP路由器建立的相邻关系
5. NLRI中发送的属性
	- ORIGIN：指出形成NLGI的方法。IGP表示是由管理员加入的，INCOMPLETE表示是聚合形成的
	- AS-PATH：记录经过的AS的AS号
	- NEXT HOP：上一个AS的出口的IP地址
6. 除非进行路由聚合，ORIGIN在扩散时一般不变
7. 在AS内扩散时AS-PATH和NEXT HOP一般不变
8. 在内部中，BGP路由器不会把iBGP邻居收到的NLRI转发给iBGP邻居，防止回路
9. 在外部中，BGP路由器会丢弃收到的AS-PATH中包含当前AS号的NLRI
10. .....（PPT）
11. AS内任意两个BGP路由器间*必须*建立iBGP关系
	- 问题：BGP路由器多时，需要建立很多关系
	- 解决：简化线路。将BGP路由器分成多个联邦，联邦内部完全关系（称作iBGP），只建立一个关系连接其他联邦（称作eGBP）。
		- 在联邦内部建立路由反射器（RR），其他路由器作为客户机与路由反射器之间建立iBGP连接。路由反射器在客户机之间传递（反射）路由信息，而客户机之间不需要建立BGP连接。进一步简化

### 内部路由如何访问外部ip地址
- 尝试一：设置默认路由。不可行
- 尝试二：路由表记录所有ip。不可行，负荷太大
- 尝试三：建立隧道：使用VCI（虚电路）或者MPLS或者SDN的方式，建立一条路，不需要查看IP分组的内容。
	- MPLS在链路层之上，IP层之下，比IP转发更高效

